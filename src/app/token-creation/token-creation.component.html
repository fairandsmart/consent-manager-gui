<mat-card *ngIf="form" [formGroup]="form">
  <mat-card-title>{{'TOKEN.FORM.TITLE' | translate}}</mat-card-title>

  <mat-card-content>

    <mat-form-field appearance="outline">
      <mat-label>{{'TOKEN.FORM.SUBJECT.LABEL' | translate}}</mat-label>
      <input matInput formControlName="subject" autocomplete="off">
    </mat-form-field>

    <mat-checkbox formControlName="vertical" checked>{{'TOKEN.FORM.ORIENTATION.LABEL' | translate}}</mat-checkbox>

    <mat-form-field appearance="outline">
      <mat-label>{{'TOKEN.FORM.HEADER.LABEL' | translate}}</mat-label>
      <input matInput formControlName="headerKey" autocomplete="off" [matAutocomplete]="headerAutocomplete">
      <mat-autocomplete autoActiveFirstOption #headerAutocomplete="matAutocomplete">
        <mat-option *ngFor="let option of optionsByType.header | async" [value]="option.key">
          {{option.name}} <small>({{option.key}})</small>
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <div class="elements-container">
      <h2>{{'TOKEN.FORM.TREATMENTS.LABEL_AVAILABLE' | translate}}</h2>
      <div
        cdkDropList
        #availableList="cdkDropList"
        [cdkDropListData]="availableTreatments"
        [cdkDropListConnectedTo]="[displayedList]"
        class="elements-list"
        (cdkDropListDropped)="drop($event)">
        <div class="element-box" *ngFor="let treatment of availableTreatments" cdkDrag>
          <span>{{treatment.name}}</span>
          <span class="element-actions">
            <button mat-icon-button (click)="addTreatment(treatment)"><mat-icon>add</mat-icon></button>
          </span>
        </div>
      </div>
    </div>

    <div class="elements-container" [class.container-invalid]="form.get('elementsKeys').touched && form.get('elementsKeys').invalid">
      <h2>{{'TOKEN.FORM.TREATMENTS.LABEL_DISPLAYED' | translate}}</h2>
      <div
        cdkDropList
        #displayedList="cdkDropList"
        [cdkDropListData]="displayedTreatments"
        [cdkDropListConnectedTo]="[availableList]"
        class="elements-list"
        (cdkDropListDropped)="drop($event)">
        <div class="element-box" *ngFor="let treatment of displayedTreatments" cdkDrag>
          <span>{{treatment.name}}</span>
          <span class="element-actions">
            <button mat-icon-button (click)="removeTreatment(treatment)"><mat-icon>delete</mat-icon></button>
          </span>
        </div>
      </div>
    </div>

    <mat-form-field appearance="outline">
      <mat-label>{{'TOKEN.FORM.FOOTER.LABEL' | translate}}</mat-label>
      <input matInput formControlName="footerKey" autocomplete="off" [matAutocomplete]="footerAutocomplete">
      <mat-autocomplete autoActiveFirstOption #footerAutocomplete="matAutocomplete">
        <mat-option *ngFor="let option of optionsByType.footer | async" [value]="option.key">
          {{option.name}} <small>({{option.key}})</small>
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>{{'TOKEN.FORM.VALIDITY.LABEL' | translate}}</mat-label>
      <input matInput formControlName="validity" autocomplete="off">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>{{'TOKEN.FORM.RECEIPT.LABEL' | translate}}</mat-label>
      <mat-select formControlName="receiptType">
        <mat-option *ngFor="let type of TYPES" [value]="type">{{'TOKEN.FORM.RECEIPT.VALUES.' + type | translate}}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>{{'TOKEN.FORM.LOCALE.LABEL' | translate}}</mat-label>
      <mat-select formControlName="locale">
        <mat-option *ngFor="let language of LANGUAGES" [value]="language">{{'COMMON.LANGUAGES.' + language.toUpperCase() | translate}}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-checkbox formControlName="forceDisplay" checked>{{'TOKEN.FORM.FORCE_DISPLAY.LABEL' | translate}}</mat-checkbox>

    <mat-form-field appearance="outline">
      <mat-label>{{'TOKEN.FORM.EMAIL.LABEL' | translate}}</mat-label>
      <input matInput formControlName="optoutEmail" autocomplete="off">
    </mat-form-field>

    <mat-checkbox formControlName="preview" checked>{{'TOKEN.FORM.PREVIEW.LABEL' | translate}}</mat-checkbox>

    <mat-card-actions>
      <button mat-button color="primary" [disabled]="form.disabled" (click)="submit()">{{'COMMON.BUTTONS.SUBMIT' | translate}}</button>
    </mat-card-actions>

    <mat-card *ngIf="token.length > 0">
      <mat-card-title>{{'TOKEN.FORM.TOKEN.LABEL' | translate}}</mat-card-title>
      <div class="token">{{token}}</div>
    </mat-card>

  </mat-card-content>
</mat-card>

<mat-card *ngIf="formUrl">
  <mat-card-title>{{'TOKEN.IFRAME.TITLE' | translate}}</mat-card-title>
  <iframe [src]="formUrl" title="Form Iframe" width="100%" height="800"></iframe>
</mat-card>
